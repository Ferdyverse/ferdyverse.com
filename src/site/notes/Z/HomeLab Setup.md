---
{"dg-publish":true,"dg-path":"Notes/homelab","permalink":"/notes/homelab/","tags":["notes/fern"],"noteIcon":"fern","updated":"2025-05-21 22:01"}
---

## Basics

Maintaining a HomeLab can be a rewarding, but timeâ€‘consuming hobby - especially once the number of services, containers and virtual machines starts to grow. Early on I found myself repeating the same manual setup steps on every new host and constantly tweaking configuration files directly on production machines. Thatâ€™s when I decided to embrace Infrastructure as Code (IaC) and let Ansible handle the heavy lifting for me.

Here is a image that should explain the basic setup for my HomeLab:
<style> .container {font-family: sans-serif; text-align: center;} .button-wrapper button {z-index: 1;height: 40px; width: 100px; margin: 10px;padding: 5px;} .excalidraw .App-menu_top .buttonList { display: flex;} .excalidraw-wrapper { height: 800px; margin: 50px; position: relative;} :root[dir="ltr"] .excalidraw .layer-ui__wrapper .zen-mode-transition.App-menu_bottom--transition-left {transform: none;} </style><script src="https://cdn.jsdelivr.net/npm/react@17/umd/react.production.min.js"></script><script src="https://cdn.jsdelivr.net/npm/react-dom@17/umd/react-dom.production.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@excalidraw/excalidraw@0/dist/excalidraw.production.min.js"></script><div id="Network_Viewexcalidraw.md1"></div><script>(function(){const InitialData={"type":"excalidraw","version":2,"source":"https://github.com/zsviczian/obsidian-excalidraw-plugin/releases/tag/2.11.1","elements":[{"id":"XuIjYnLlpl2BGzGomfZLm","type":"arrow","x":133.91651777775735,"y":-185.04585967576656,"width":199.8365209389882,"height":529.1603411561032,"angle":0,"strokeColor":"#f08c00","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"a0","roundness":{"type":2},"seed":1008713556,"version":858,"versionNonce":511435348,"isDeleted":false,"boundElements":[{"type":"text","id":"erUmtezw"}],"updated":1747852052908,"link":null,"locked":false,"points":[[0,0],[-31.520548716765802,-424.11550388815874],[-199.8365209389882,-529.1603411561032]],"lastCommittedPoint":null,"startBinding":{"elementId":"XtPR0tf8yjuL3YpIFUXBj","focus":0.5466049373602248,"gap":1.2580409356725113},"endBinding":{"elementId":"awE3kNXc","focus":-0.4854492547977496,"gap":17.42489329555532},"startArrowhead":null,"endArrowhead":"arrow","elbowed":false},{"id":"erUmtezw","type":"text","x":17.196056036089203,"y":-621.6613635639253,"width":170.3998260498047,"height":25,"angle":0,"strokeColor":"#f08c00","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"a1","roundness":null,"seed":270843860,"version":21,"versionNonce":947574100,"isDeleted":false,"boundElements":[],"updated":1747851230475,"link":null,"locked":false,"text":"External Request","rawText":"External Request","fontSize":20,"fontFamily":5,"textAlign":"center","verticalAlign":"middle","containerId":"XuIjYnLlpl2BGzGomfZLm","originalText":"External Request","autoResize":true,"lineHeight":1.25},{"id":"awE3kNXc","type":"image","x":-180.66520895678616,"y":-765.7451939797398,"width":97.32031249999999,"height":97.32031249999999,"angle":0,"strokeColor":"transparent","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"roundness":null,"seed":2549,"version":801,"versionNonce":262859988,"updated":1747852052905,"isDeleted":false,"groupIds":["A3mPqqPY-bNGxp9eXofif"],"boundElements":[{"id":"XuIjYnLlpl2BGzGomfZLm","type":"arrow"},{"id":"piK1VnwrKLMOlqmI0Yw1z","type":"arrow"}],"link":null,"locked":false,"fileId":"13efb430bc69d3ff7098aa0fcd1bd8722fec435a","scale":[1,1],"index":"a2","frameId":null,"status":"pending","crop":null},{"id":"fIOlcf9n","type":"text","x":-215.5492040129385,"y":-667.7217564797398,"width":167.0883026123047,"height":20,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":["A3mPqqPY-bNGxp9eXofif"],"frameId":null,"index":"a3","roundness":null,"seed":874251220,"version":471,"versionNonce":171167340,"isDeleted":false,"boundElements":[{"id":"XuIjYnLlpl2BGzGomfZLm","type":"arrow"},{"id":"WidHqo2E_G8hbnNxFo6zk","type":"arrow"}],"updated":1747852052905,"link":null,"locked":false,"text":"UDM | Dream Machine","rawText":"UDM | Dream Machine","fontSize":16,"fontFamily":5,"textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"UDM | Dream Machine","autoResize":true,"lineHeight":1.25},{"id":"kNbcFoN4","type":"image","x":-185.00355139573708,"y":-974.5267290545434,"width":109.15671960012403,"height":99.18246849434223,"angle":0,"strokeColor":"transparent","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"roundness":null,"seed":89364,"version":1148,"versionNonce":60411732,"updated":1747852052905,"isDeleted":false,"groupIds":["cYaKw0d1uauIxdnTi6SAD"],"boundElements":[{"id":"ugOYM3xv4te7oKEZxm5YJ","type":"arrow"}],"link":null,"locked":false,"fileId":"b861d05f55c489cb9f681938d8001df8ee362fcf","scale":[1,1],"index":"a4","frameId":null,"status":"pending","crop":null},{"id":"9UUo2fQ1","type":"text","x":-181.50514002096804,"y":-883.0487964102954,"width":102.15989685058594,"height":25,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":["cYaKw0d1uauIxdnTi6SAD"],"frameId":null,"index":"a5","roundness":null,"seed":2000915180,"version":273,"versionNonce":2010109932,"isDeleted":false,"boundElements":[{"id":"piK1VnwrKLMOlqmI0Yw1z","type":"arrow"}],"updated":1747852052905,"link":null,"locked":false,"text":"Fritz! Box","rawText":"Fritz! Box","fontSize":20,"fontFamily":5,"textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"Fritz! Box","autoResize":true,"lineHeight":1.25},{"id":"KzYjESgb","type":"image","x":-191.8017892493309,"y":-449.37238729953333,"width":124.17832382022384,"height":124.17832382022384,"angle":0,"strokeColor":"transparent","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"roundness":null,"seed":17041,"version":588,"versionNonce":65905260,"updated":1747852052905,"isDeleted":false,"groupIds":["_Zr0y4JhajFl3USkLNXJ1"],"boundElements":[{"id":"y03bzR0PhQMQpcLlDGWop","type":"arrow"},{"id":"0zTwVKRz4XwXdMCZHbKYq","type":"arrow"},{"id":"WidHqo2E_G8hbnNxFo6zk","type":"arrow"},{"id":"KMgVEb4B-VZVTGrXXks7M","type":"arrow"},{"id":"QiTHKwDEAO64CfiWsxQhS","type":"arrow"}],"link":null,"locked":false,"fileId":"ce9a0255db39eb4d80329358f7a752b405f14bb8","scale":[1,1],"index":"a6","frameId":null,"status":"pending","crop":null},{"id":"qFryg9Ms","type":"text","x":-231.12376778111354,"y":-320.1463263445864,"width":202.70791625976562,"height":21.281632188555925,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":["_Zr0y4JhajFl3USkLNXJ1"],"frameId":null,"index":"a7","roundness":null,"seed":651505876,"version":342,"versionNonce":1544231252,"isDeleted":false,"boundElements":[{"id":"0zTwVKRz4XwXdMCZHbKYq","type":"arrow"},{"id":"nQEKUkz56hySoi2-m0UHW","type":"arrow"}],"updated":1747852052905,"link":null,"locked":false,"text":"Caddy as Reverse-Proxy","rawText":"Caddy as Reverse-Proxy","fontSize":17.02530575084474,"fontFamily":5,"textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"Caddy as Reverse-Proxy","autoResize":true,"lineHeight":1.25},{"id":"piK1VnwrKLMOlqmI0Yw1z","type":"arrow","x":-131.7731670037087,"y":-848.7223330449194,"width":0.37896823587982453,"height":73.32118055555554,"angle":0,"strokeColor":"#1971c2","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"a8","roundness":{"type":2},"seed":749432428,"version":370,"versionNonce":1507569876,"isDeleted":false,"boundElements":[],"updated":1747852052907,"link":null,"locked":false,"points":[[0,0],[-0.37896823587982453,73.32118055555554]],"lastCommittedPoint":null,"startBinding":{"elementId":"9UUo2fQ1","focus":0.024149225073219358,"gap":9.326463365375957},"endBinding":{"elementId":"awE3kNXc","focus":-0.009173371573201567,"gap":9.655958509624043},"startArrowhead":null,"endArrowhead":"arrow","elbowed":false},{"id":"lm4i8d9e","type":"image","x":-502.13680003623057,"y":-627.8911698504752,"width":115.71484375000001,"height":115.71484375000001,"angle":0,"strokeColor":"transparent","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"roundness":null,"seed":24507,"version":737,"versionNonce":1483062636,"updated":1747852052904,"isDeleted":false,"groupIds":["nWp4GEpCuh8jw2DIPNg28"],"boundElements":[{"id":"y03bzR0PhQMQpcLlDGWop","type":"arrow"}],"link":null,"locked":false,"fileId":"9362f516c278987d3e2eca82cd4ce03faaec5af5","scale":[1,1],"index":"aA","frameId":null,"status":"pending","crop":null},{"id":"zFQOxv2B","type":"text","x":-523.8993122432618,"y":-521.9419511004752,"width":159.2398681640625,"height":25,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":["nWp4GEpCuh8jw2DIPNg28"],"frameId":null,"index":"aB","roundness":null,"seed":1655099732,"version":562,"versionNonce":401612628,"isDeleted":false,"boundElements":[],"updated":1747852052904,"link":null,"locked":false,"text":"Proxmox Cluster","rawText":"Proxmox Cluster","fontSize":20,"fontFamily":5,"textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"Proxmox Cluster","autoResize":true,"lineHeight":1.25},{"id":"y03bzR0PhQMQpcLlDGWop","type":"arrow","x":-201.01439278111351,"y":-389.77519422753164,"width":207.8863016165216,"height":6.2763258639818105,"angle":0,"strokeColor":"#1971c2","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"aC","roundness":{"type":2},"seed":1271529708,"version":897,"versionNonce":1235050964,"isDeleted":false,"boundElements":[{"type":"text","id":"INsYrm9j"}],"updated":1747852152478,"link":null,"locked":false,"points":[[0,0],[-207.8863016165216,-6.2763258639818105]],"lastCommittedPoint":null,"startBinding":{"elementId":"KzYjESgb","focus":0.005316880436247954,"gap":9.212603531782634},"endBinding":{"elementId":"bsq-a3c1n4tt-UWOvf1x5","focus":-0.7783062154742939,"gap":10.165005154079836},"startArrowhead":null,"endArrowhead":"arrow","elbowed":false},{"id":"INsYrm9j","type":"text","x":-344.8874981181829,"y":-405.4125779051327,"width":79.85990905761719,"height":25,"angle":0,"strokeColor":"#1971c2","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"aCV","roundness":null,"seed":310261972,"version":14,"versionNonce":907583444,"isDeleted":false,"boundElements":[],"updated":1747852052906,"link":null,"locked":false,"text":"Request","rawText":"Request","fontSize":20,"fontFamily":5,"textAlign":"center","verticalAlign":"middle","containerId":"y03bzR0PhQMQpcLlDGWop","originalText":"Request","autoResize":true,"lineHeight":1.25},{"id":"EzVJeixr","type":"image","x":-798.3604224382505,"y":-387.6706837393639,"width":106.75243664717348,"height":106.9609375,"angle":0,"strokeColor":"transparent","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"roundness":null,"seed":78371,"version":743,"versionNonce":349770964,"updated":1747852052904,"isDeleted":false,"groupIds":["q1LuoSWfq7crrzJay03Gt"],"boundElements":[],"link":null,"locked":false,"fileId":"b5e6aaf3150f1a2e710f9c944ea7ba453fc328aa","scale":[1,1],"index":"aD","frameId":null,"status":"pending","crop":null},{"id":"qXkSE5G4","type":"text","x":-828.6741150033356,"y":-282.4284962393639,"width":167.37982177734375,"height":25,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":["q1LuoSWfq7crrzJay03Gt"],"frameId":null,"index":"aE","roundness":null,"seed":602027500,"version":552,"versionNonce":277762668,"isDeleted":false,"boundElements":[],"updated":1747852052904,"link":null,"locked":false,"text":"Docker Container","rawText":"Docker Container","fontSize":20,"fontFamily":5,"textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"Docker Container","autoResize":true,"lineHeight":1.25},{"id":"tuz0PDxZ","type":"image","x":-592.2452896249176,"y":-380.6277149893639,"width":93.0625,"height":93.0625,"angle":0,"strokeColor":"transparent","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"roundness":null,"seed":77909,"version":762,"versionNonce":1141332564,"updated":1747852052904,"isDeleted":false,"groupIds":["3gIS6XdpMdN3UkbuewbpF"],"boundElements":[],"link":null,"locked":false,"fileId":"5e12601d2fc8387bc9ca3da4598412de76209af4","scale":[1,1],"index":"aF","frameId":null,"status":"pending","crop":null},{"id":"nOrXXg1D","type":"text","x":-620.2639587533356,"y":-280.4597462393639,"width":149.09983825683594,"height":50,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":["3gIS6XdpMdN3UkbuewbpF"],"frameId":null,"index":"aG","roundness":null,"seed":2028066412,"version":584,"versionNonce":1718691052,"isDeleted":false,"boundElements":[],"updated":1747852052904,"link":null,"locked":false,"text":"Linux Container\nLXC","rawText":"Linux Container\nLXC","fontSize":20,"fontFamily":5,"textAlign":"center","verticalAlign":"top","containerId":null,"originalText":"Linux Container\nLXC","autoResize":true,"lineHeight":1.25},{"id":"NNrxKZjH","type":"image","x":-809.2148750436188,"y":-208.2449024893639,"width":95.84765625000003,"height":95.84765625000003,"angle":0,"strokeColor":"transparent","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"roundness":null,"seed":73767,"version":743,"versionNonce":1347481556,"updated":1747852052904,"isDeleted":false,"groupIds":["YG-mjTftWaWpgw1TnheE4"],"boundElements":[],"link":null,"locked":false,"fileId":"c458177597f54d89eb102ab181ef1487d3dbf6cf","scale":[1,1],"index":"aH","frameId":null,"status":"pending","crop":null},{"id":"kBbjxgh2","type":"text","x":-797.5210044991852,"y":-103.56912123936388,"width":72.45991516113281,"height":25,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":["YG-mjTftWaWpgw1TnheE4"],"frameId":null,"index":"aI","roundness":null,"seed":1686594156,"version":464,"versionNonce":1297459052,"isDeleted":false,"boundElements":[],"updated":1747852052904,"link":null,"locked":false,"text":"Forgejo","rawText":"Forgejo","fontSize":20,"fontFamily":5,"textAlign":"center","verticalAlign":"top","containerId":null,"originalText":"Forgejo","autoResize":true,"lineHeight":1.25},{"id":"OMVD3lmu","type":"image","x":-591.8772400033356,"y":-206.16677748936388,"width":95.56249999999999,"height":95.56249999999999,"angle":0,"strokeColor":"transparent","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"roundness":null,"seed":61504,"version":697,"versionNonce":432788820,"updated":1747852052904,"isDeleted":false,"groupIds":["i_1bqDuZKQnKqQ25-8-tL"],"boundElements":[],"link":null,"locked":false,"fileId":"e4e1eec3cc132238609e813a8f2847362658e024","scale":[1,1],"index":"aJ","frameId":null,"status":"pending","crop":null},{"id":"rgbSI6KC","type":"text","x":-619.3959091317536,"y":-102.99490248936388,"width":150.59983825683594,"height":25,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":["i_1bqDuZKQnKqQ25-8-tL"],"frameId":null,"index":"aK","roundness":null,"seed":2001571412,"version":425,"versionNonce":428202476,"isDeleted":false,"boundElements":[],"updated":1747852052905,"link":null,"locked":false,"text":"Home Assistant","rawText":"Home Assistant","fontSize":20,"fontFamily":5,"textAlign":"center","verticalAlign":"top","containerId":null,"originalText":"Home Assistant","autoResize":true,"lineHeight":1.25},{"id":"bsq-a3c1n4tt-UWOvf1x5","type":"rectangle","x":-882.7066670866689,"y":-440.3933399893639,"width":465.98828125,"height":383.83159722222206,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"dashed","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"aL","roundness":{"type":3},"seed":755827156,"version":838,"versionNonce":1590649964,"isDeleted":false,"boundElements":[{"type":"text","id":"UCchJknm"},{"id":"y03bzR0PhQMQpcLlDGWop","type":"arrow"},{"id":"0zTwVKRz4XwXdMCZHbKYq","type":"arrow"}],"updated":1747852052905,"link":null,"locked":false},{"id":"UCchJknm","type":"text","x":-730.4228612395009,"y":-435.3933399893639,"width":161.42066955566406,"height":35,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"dashed","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"aM","roundness":null,"seed":1812233708,"version":41,"versionNonce":919383380,"isDeleted":false,"boundElements":[],"updated":1747852052905,"link":null,"locked":false,"text":"Applications","rawText":"Applications","fontSize":28,"fontFamily":5,"textAlign":"center","verticalAlign":"top","containerId":"bsq-a3c1n4tt-UWOvf1x5","originalText":"Applications","autoResize":true,"lineHeight":1.25},{"id":"0zTwVKRz4XwXdMCZHbKYq","type":"arrow","x":-414.02632074666445,"y":-238.958567323117,"width":213.1646915433368,"height":118.26008693409625,"angle":0,"strokeColor":"#2f9e44","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"aN","roundness":{"type":2},"seed":157929172,"version":916,"versionNonce":1421477716,"isDeleted":false,"boundElements":[{"type":"text","id":"CDv4ykdn"}],"updated":1747852152478,"link":null,"locked":false,"points":[[0,0],[213.1646915433368,-118.26008693409625]],"lastCommittedPoint":null,"startBinding":{"elementId":"bsq-a3c1n4tt-UWOvf1x5","focus":0.4356161412603265,"gap":3.4921875},"endBinding":{"elementId":"KzYjESgb","focus":0.09721675655650722,"gap":9.059839953996715},"startArrowhead":null,"endArrowhead":"arrow","elbowed":false},{"id":"CDv4ykdn","type":"text","x":-353.03392553651946,"y":-310.33706347188223,"width":91.17990112304688,"height":25,"angle":0,"strokeColor":"#2f9e44","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"aO","roundness":null,"seed":1895136980,"version":27,"versionNonce":1260225876,"isDeleted":false,"boundElements":[],"updated":1747852052906,"link":null,"locked":false,"text":"Response","rawText":"Response","fontSize":20,"fontFamily":5,"textAlign":"center","verticalAlign":"middle","containerId":"0zTwVKRz4XwXdMCZHbKYq","originalText":"Response","autoResize":true,"lineHeight":1.25},{"id":"wA7ZVFXI","type":"image","x":-108.17064278111309,"y":-172.10210735047508,"width":106.78125,"height":106.78125,"angle":0,"strokeColor":"transparent","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"roundness":null,"seed":60475,"version":922,"versionNonce":2129498196,"updated":1747852052905,"isDeleted":false,"groupIds":["rYluGOa7WaFQYZT6oKG3a"],"boundElements":[],"link":null,"locked":false,"fileId":"15253a68f389006898206b37a1663e44b90d1a22","scale":[1,1],"index":"aOV","frameId":null,"status":"pending","crop":null},{"id":"tpYoYk2c","type":"text","x":-122.7530546531292,"y":-57.42198582269725,"width":134.99989318847656,"height":50,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":["rYluGOa7WaFQYZT6oKG3a"],"frameId":null,"index":"aP","roundness":null,"seed":199126252,"version":580,"versionNonce":1555123948,"isDeleted":false,"boundElements":[],"updated":1747852052905,"link":null,"locked":false,"text":"DNS 1\nAdguard Home","rawText":"DNS 1\nAdguard Home","fontSize":20,"fontFamily":5,"textAlign":"center","verticalAlign":"top","containerId":null,"originalText":"DNS 1\nAdguard Home","autoResize":true,"lineHeight":1.25},{"id":"a-eWym-9lKzHWrVSt-ObV","type":"image","x":84.43612805222017,"y":-171.07780179491942,"width":106.78125,"height":106.78125,"angle":0,"strokeColor":"transparent","backgroundColor":"transparent","fillStyle":"hachure","strokeWidth":1,"strokeStyle":"solid","roughness":1,"opacity":100,"roundness":null,"seed":1702489684,"version":1017,"versionNonce":2097178068,"updated":1747852052905,"isDeleted":false,"groupIds":["iE_uXC5pE-Y_E-DI2e_9F"],"boundElements":[],"link":null,"locked":false,"fileId":"15253a68f389006898206b37a1663e44b90d1a22","scale":[1,1],"index":"aRV","frameId":null,"status":"pending","crop":null},{"id":"FJlD23xz","type":"text","x":70.32680645798189,"y":-60.163739294919424,"width":134.99989318847656,"height":50,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":["iE_uXC5pE-Y_E-DI2e_9F"],"frameId":null,"index":"aS","roundness":null,"seed":1001694572,"version":668,"versionNonce":503353708,"isDeleted":false,"boundElements":[],"updated":1747852052905,"link":null,"locked":false,"text":"DNS 2\nAdguard Home","rawText":"DNS 2\nAdguard Home","fontSize":20,"fontFamily":5,"textAlign":"center","verticalAlign":"top","containerId":null,"originalText":"DNS 2\nAdguard Home","autoResize":true,"lineHeight":1.25},{"id":"XtPR0tf8yjuL3YpIFUXBj","type":"rectangle","x":-147.79260458666863,"y":-184.45280179491954,"width":368.61805555555554,"height":195.86848958333348,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"dashed","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"aT","roundness":{"type":3},"seed":1698641004,"version":563,"versionNonce":13378412,"isDeleted":false,"boundElements":[{"id":"XuIjYnLlpl2BGzGomfZLm","type":"arrow"},{"id":"hFmj72gLyiMtq3QkMADgy","type":"arrow"},{"id":"nQEKUkz56hySoi2-m0UHW","type":"arrow"}],"updated":1747852052905,"link":null,"locked":false},{"id":"nS8QOR8x","type":"text","x":397.49364606570737,"y":-404.126641341703,"width":140.40003967285156,"height":90,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"aV","roundness":null,"seed":85980012,"version":1484,"versionNonce":1697371220,"isDeleted":false,"boundElements":[{"id":"hFmj72gLyiMtq3QkMADgy","type":"arrow"},{"id":"KMgVEb4B-VZVTGrXXks7M","type":"arrow"}],"updated":1747852052905,"link":null,"locked":false,"text":"Internal\nClients","rawText":"Internal\nClients","fontSize":36,"fontFamily":5,"textAlign":"center","verticalAlign":"top","containerId":null,"originalText":"Internal\nClients","autoResize":true,"lineHeight":1.25},{"id":"hFmj72gLyiMtq3QkMADgy","type":"arrow","x":384.23842472469005,"y":-342.42895126082107,"width":172.89430489088696,"height":155.06429645611252,"angle":0,"strokeColor":"#f08c00","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"aX","roundness":{"type":2},"seed":284795860,"version":1981,"versionNonce":2066715348,"isDeleted":false,"boundElements":[{"type":"text","id":"mpbwGirn"}],"updated":1747852052908,"link":null,"locked":false,"points":[[0,0],[-172.89430489088696,155.06429645611252]],"lastCommittedPoint":null,"startBinding":{"elementId":"nS8QOR8x","focus":0.5387091709168023,"gap":13.255221341017318},"endBinding":{"elementId":"XtPR0tf8yjuL3YpIFUXBj","focus":0.2128179349905622,"gap":9.977595320000091},"startArrowhead":null,"endArrowhead":"arrow","elbowed":false},{"id":"mpbwGirn","type":"text","x":257.861317750438,"y":-277.3968030327648,"width":79.85990905761719,"height":25,"angle":0,"strokeColor":"#f08c00","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"dashed","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"aY","roundness":null,"seed":1861632340,"version":13,"versionNonce":2111606868,"isDeleted":false,"boundElements":[],"updated":1747851232820,"link":null,"locked":false,"text":"Request","rawText":"Request","fontSize":20,"fontFamily":5,"textAlign":"center","verticalAlign":"middle","containerId":"hFmj72gLyiMtq3QkMADgy","originalText":"Request","autoResize":true,"lineHeight":1.25},{"id":"durFcIMfeKUlBzrjin2v5","type":"rectangle","x":-912.2741698278973,"y":-484.2785510639254,"width":945.5729166666666,"height":537.3480902777777,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"aZ","roundness":{"type":3},"seed":2002669420,"version":225,"versionNonce":1686382188,"isDeleted":false,"boundElements":[{"id":"QiTHKwDEAO64CfiWsxQhS","type":"arrow"}],"updated":1747852052905,"link":null,"locked":false},{"id":"WidHqo2E_G8hbnNxFo6zk","type":"arrow","x":-130.94856717402166,"y":-643.0198705083698,"width":5.076390922288027,"height":189.84704975100618,"angle":0,"strokeColor":"#1971c2","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"aa","roundness":{"type":2},"seed":1658735188,"version":129,"versionNonce":1879306580,"isDeleted":false,"boundElements":[],"updated":1747852052907,"link":null,"locked":false,"points":[[0,0],[-5.076390922288027,189.84704975100618]],"lastCommittedPoint":null,"startBinding":{"elementId":"fIOlcf9n","focus":-0.017292245307069177,"gap":4.701885971370075},"endBinding":{"elementId":"KzYjESgb","focus":-0.12673836721488094,"gap":3.800433457830195},"startArrowhead":null,"endArrowhead":"arrow","elbowed":false},{"id":"nQEKUkz56hySoi2-m0UHW","type":"arrow","x":-53.116666349419404,"y":-186.03352092712385,"width":51.50161367195062,"height":106.00110652569037,"angle":0,"strokeColor":"#f08c00","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"ab","roundness":{"type":2},"seed":1419840236,"version":82,"versionNonce":918445396,"isDeleted":false,"boundElements":[{"type":"text","id":"xXQJq3iT"}],"updated":1747852052908,"link":null,"locked":false,"points":[[0,0],[-51.50161367195062,-106.00110652569037]],"lastCommittedPoint":null,"startBinding":{"elementId":"XtPR0tf8yjuL3YpIFUXBj","focus":-0.17803209083622512,"gap":3.3283534356725113},"endBinding":{"elementId":"qFryg9Ms","focus":-0.15602969844358364,"gap":6.830066703216232},"startArrowhead":null,"endArrowhead":"arrow","elbowed":false},{"id":"xXQJq3iT","type":"text","x":-161.79738956723065,"y":-251.53407418996903,"width":165.85983276367188,"height":25,"angle":0,"strokeColor":"#f08c00","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"abV","roundness":null,"seed":48041940,"version":24,"versionNonce":1920358996,"isDeleted":false,"boundElements":[],"updated":1747851227887,"link":null,"locked":false,"text":"Internal Request","rawText":"Internal Request","fontSize":20,"fontFamily":5,"textAlign":"center","verticalAlign":"middle","containerId":"nQEKUkz56hySoi2-m0UHW","originalText":"Internal Request","autoResize":true,"lineHeight":1.25},{"id":"2icbHtAQiGYCf3GmVCiwW","type":"freedraw","x":-563.979898994564,"y":-236.3662246750364,"width":0.0001,"height":0.0001,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"ah","roundness":null,"seed":1849522028,"version":31,"versionNonce":1397021652,"isDeleted":false,"boundElements":[],"updated":1747852052905,"link":null,"locked":false,"points":[[0,0],[0.0001,0.0001]],"pressures":[],"simulatePressure":true,"lastCommittedPoint":null},{"id":"KMgVEb4B-VZVTGrXXks7M","type":"arrow","x":-52.85576705011954,"y":-385.521733670624,"width":440.92148844401027,"height":15.51594003941534,"angle":0,"strokeColor":"#e03131","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"aiV","roundness":{"type":2},"seed":867189228,"version":259,"versionNonce":1710337132,"isDeleted":false,"boundElements":[{"type":"text","id":"f7Hme1zn"}],"updated":1747852105017,"link":null,"locked":false,"points":[[0,0],[186.78515625,6.828686078920839],[440.92148844401027,15.51594003941534]],"lastCommittedPoint":null,"startBinding":{"elementId":"KzYjESgb","focus":-0.07746580119353601,"gap":14.767698378987532},"endBinding":{"elementId":"nS8QOR8x","focus":0.25081836483271813,"gap":9.42792467181664},"startArrowhead":null,"endArrowhead":"arrow","elbowed":false},{"id":"f7Hme1zn","type":"text","x":45.33947678532968,"y":-391.19304759170313,"width":177.17982482910156,"height":25,"angle":0,"strokeColor":"#e03131","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"dashed","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"aj","roundness":null,"seed":528154348,"version":23,"versionNonce":2085325652,"isDeleted":false,"boundElements":[],"updated":1747851238399,"link":null,"locked":false,"text":"Internal Response","rawText":"Internal Response","fontSize":20,"fontFamily":5,"textAlign":"center","verticalAlign":"middle","containerId":"KMgVEb4B-VZVTGrXXks7M","originalText":"Internal Response","autoResize":true,"lineHeight":1.25},{"id":"RDJ4GcSS","type":"text","x":-603.0137772613749,"y":-972.7627424497321,"width":148.57203674316406,"height":90,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"dashed","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"al","roundness":null,"seed":1555243244,"version":489,"versionNonce":889522772,"isDeleted":false,"boundElements":[{"id":"ugOYM3xv4te7oKEZxm5YJ","type":"arrow"},{"id":"QiTHKwDEAO64CfiWsxQhS","type":"arrow"}],"updated":1747852052905,"link":null,"locked":false,"text":"External\nClient","rawText":"External\nClient","fontSize":36,"fontFamily":5,"textAlign":"center","verticalAlign":"top","containerId":null,"originalText":"External\nClient","autoResize":true,"lineHeight":1.25},{"id":"ugOYM3xv4te7oKEZxm5YJ","type":"arrow","x":-449.08287572072413,"y":-926.5244956500089,"width":250.9363498572714,"height":1.820135756595505,"angle":0,"strokeColor":"#1971c2","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"am","roundness":{"type":2},"seed":104666348,"version":522,"versionNonce":362802644,"isDeleted":false,"boundElements":[{"type":"text","id":"28nI7rmP"}],"updated":1747852052908,"link":null,"locked":false,"points":[[0,0],[250.9363498572714,-1.820135756595505]],"lastCommittedPoint":null,"startBinding":{"elementId":"RDJ4GcSS","focus":0.03981429491302347,"gap":5.358864797486632},"endBinding":{"elementId":"kNbcFoN4","focus":0.07803880922804916,"gap":13.142974467715675},"startArrowhead":null,"endArrowhead":"arrow","elbowed":false},{"id":"28nI7rmP","type":"text","x":-363.54465532089705,"y":-939.9345635283066,"width":79.85990905761719,"height":25,"angle":0,"strokeColor":"#1971c2","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"an","roundness":null,"seed":282051052,"version":13,"versionNonce":1161823188,"isDeleted":false,"boundElements":[],"updated":1747851215598,"link":null,"locked":false,"text":"Request","rawText":"Request","fontSize":20,"fontFamily":5,"textAlign":"center","verticalAlign":"middle","containerId":"ugOYM3xv4te7oKEZxm5YJ","originalText":"Request","autoResize":true,"lineHeight":1.25},{"id":"QiTHKwDEAO64CfiWsxQhS","type":"arrow","x":-179.65591000782308,"y":-461.5440180910816,"width":353.5754775534915,"height":412.08677991420586,"angle":0,"strokeColor":"#2f9e44","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"ao","roundness":{"type":2},"seed":372876116,"version":566,"versionNonce":411767636,"isDeleted":false,"boundElements":[{"type":"text","id":"8hBxyHyj"}],"updated":1747852052908,"link":null,"locked":false,"points":[[0,0],[-353.5754775534915,-412.08677991420586]],"lastCommittedPoint":null,"startBinding":{"elementId":"KzYjESgb","focus":0.11939158833338295,"gap":12.17163079154841},"endBinding":{"elementId":"RDJ4GcSS","focus":0.45128180183149125,"gap":9.131944444444457},"startArrowhead":null,"endArrowhead":"arrow","elbowed":false},{"id":"8hBxyHyj","type":"text","x":-402.0335993460923,"y":-680.0874080481846,"width":91.17990112304688,"height":25,"angle":0,"strokeColor":"#2f9e44","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"ap","roundness":null,"seed":1385290580,"version":12,"versionNonce":2055321684,"isDeleted":false,"boundElements":[],"updated":1747851190438,"link":null,"locked":false,"text":"Response","rawText":"Response","fontSize":20,"fontFamily":5,"textAlign":"center","verticalAlign":"middle","containerId":"QiTHKwDEAO64CfiWsxQhS","originalText":"Response","autoResize":true,"lineHeight":1.25}],"appState":{"theme":"dark","viewBackgroundColor":"#ffffff","currentItemStrokeColor":"#e03131","currentItemBackgroundColor":"transparent","currentItemFillStyle":"solid","currentItemStrokeWidth":2,"currentItemStrokeStyle":"solid","currentItemRoughness":1,"currentItemOpacity":100,"currentItemFontFamily":5,"currentItemFontSize":36,"currentItemTextAlign":"center","currentItemStartArrowhead":null,"currentItemEndArrowhead":"arrow","currentItemArrowType":"round","scrollX":978.884241004157,"scrollY":1001.5689571559553,"zoom":{"value":1.193643},"currentItemRoundness":"round","gridSize":20,"gridStep":5,"gridModeEnabled":false,"gridColor":{"Bold":"rgba(217, 217, 217, 0.5)","Regular":"rgba(230, 230, 230, 0.5)"},"currentStrokeOptions":null,"frameRendering":{"enabled":true,"clip":true,"name":true,"outline":true},"objectsSnapModeEnabled":false,"activeTool":{"type":"selection","customType":null,"locked":false,"fromSelection":false,"lastActiveTool":null}},"files":{}};InitialData.scrollToContent=true;App=()=>{const e=React.useRef(null),t=React.useRef(null),[n,i]=React.useState({width:void 0,height:void 0});return React.useEffect(()=>{i({width:t.current.getBoundingClientRect().width,height:t.current.getBoundingClientRect().height});const e=()=>{i({width:t.current.getBoundingClientRect().width,height:t.current.getBoundingClientRect().height})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[t]),React.createElement(React.Fragment,null,React.createElement("div",{className:"excalidraw-wrapper",ref:t},React.createElement(ExcalidrawLib.Excalidraw,{ref:e,width:n.width,height:n.height,initialData:InitialData,viewModeEnabled:!0,zenModeEnabled:!0,gridModeEnabled:!1})))},excalidrawWrapper=document.getElementById("Network_Viewexcalidraw.md1");ReactDOM.render(React.createElement(App),excalidrawWrapper);})();</script>

## The Repo

You can browse the entire setup here -> [Ferdyverse/HomeLab on Github](https://github.com/Ferdyverse/HomeLab) 
The repository is organised like this (simplified):
```
HomeLab/
â”œâ”€â”€ group_vars/
â”‚   â”œâ”€â”€ all/
â”‚   â””â”€â”€ proxmox_nodes/
â”œâ”€â”€ handlers/
â”œâ”€â”€ inventorys/  # inventory files (yes, the repo spells it this way)
â”œâ”€â”€ roles/
â”‚   â”œâ”€â”€ adguard_home/
â”‚   â”œâ”€â”€ caddy/
â”‚   â”œâ”€â”€ grafana/
â”‚   â”œâ”€â”€ ntfy/
â”‚   â”œâ”€â”€ pve/
â”‚   â”œâ”€â”€ semaphore/
â”‚   â””â”€â”€ ... (other service roles)
â”œâ”€â”€ tasks/
â”œâ”€â”€ templates/
â”œâ”€â”€ ansible.cfg
â”œâ”€â”€ container_configure.yml
â”œâ”€â”€ container_create.yml
â”œâ”€â”€ nodes_configure.yml
â”œâ”€â”€ requirements.yml  # Ansible Galaxy collections
â”œâ”€â”€ requirements.txt  # Python dependencies
â””â”€â”€ setup_environment.sh
```
## Settings
Below are some defaults I rely on throughout the lab. Sticking to a convention means every new service knows exactly where to mount volumes and look for its configuration.
### Docker
For my docker setup I currently use many lxc containers. I thought about switching to Docker Swarm, but I do not see any benefits for my setup because I only have 2 Proxmox nodes.

On each of my docker nodes I have the following storage setup:

| Path                              | Purpose                                                                                          |
| --------------------------------- | ------------------------------------------------------------------------------------------------ |
| `/home/{{ default_user }}/docker` | **DockerÂ Compose files** â€“ One folder per stack or service.                                      |
| `/docker`                         | **Configuration files** â€“ Static configs such as `traefik.yml`, `grafana.ini`, `promtail.yml`,Â â€¦ |
| `/data`                           | **Persistent data** â€“ Bind mounts for databases, Prometheus TSDB, MinIO buckets, etc.            |

> **NoteÂ ðŸ“**Â Â All directories are created and owned by **UIDÂ `1000`** (the primary unprivileged user on my nodes). This avoids permission headaches when containers dropÂ root privileges.

## Secrets
For my secret management I use 1Password with a special HomeLab-Vault. I recently discovered the possibility to use the [1Password-Connect Stack](https://developer.1password.com/docs/connect/) to be able to use my secrets via a REST-API in Ansible and other services. This stack consists out of two main components . The Connect-API and the Connect-Sync container.

```yaml
services:
  op-connect-api:
    image: 1password/connect-api:latest
    restart: unless-stopped
    volumes:
      - '{{ docker_container_data_folder }}/onepassword/data:/home/opuser/.op/data'
      - './token.json:/home/opuser/.op/1password-credentials.json'
    ports:
      - 8085:8080

  op-connect-sync:
    image: 1password/connect-sync:latest
    restart: unless-stopped
    volumes:
      - '{{ docker_container_data_folder }}/onepassword/data:/home/opuser/.op/data'
      - './token.json:/home/opuser/.op/1password-credentials.json'
```

## CI/CD

I mainly use a Forgejo runner for my pipelines. There I configured a pipeline called `autoupdate`.

The `autoupdate` pipeline runs automatically on each push and checks for certain file changes. Based on the found changes it updates some of my HomeLab services.

```yaml
name: update-homelab-services

on:
  push:
    branches: [ main ]
    paths:
      - '**/roles/glance/files/**'
      - '**/roles/glance/templates/**'
      - '**/roles/caddy/vars/main.yml'
      - '**/roles/caddy/templates/**'
      - '**/roles/ntfy/defaults/main.yml'
      - '**/roles/pve/vars/main.yml'
  workflow_dispatch:
    inputs:
      service:
        description: 'Service to update'
        required: false
        default: auto
        type: choice
        options: [auto, caddy, glance, ntfy, pve, all]

jobs:
  update:
    runs-on: ubuntu-ansible
    container:
      env:
        ANSIBLE_STRATEGY: serverscom.mitogen.mitogen_linear
        OP_CONNECT_HOST: ${{ vars.OP_CONNECT_HOST }}
        OP_CONNECT_TOKEN: ${{ secrets.OP_CONNECT_TOKEN }}
    steps:
      - name: Checkout latest version
        uses: actions/checkout@v4
      - name: Filter changed files
        id: filter
        uses: https://github.com/dorny/paths-filter@v3
        with:
          filters: |
            glance:
              - 'roles/glance/files/**'
              - 'roles/glance/templates/**'
            caddy:
              - 'roles/caddy/vars/main.yml'
              - 'roles/caddy/templates/**'
            ntfy:
              - 'roles/ntfy/defaults/main.yml'
            pve:
              - 'roles/pve/vars/main.yml'
      - name: Prepare Ansible
        run: ansible-galaxy install -r requirements.yml
      - name: Update Glance Pages
        if: |
          (steps.filter.outputs.glance == 'true' && github.event_name != 'workflow_dispatch') ||
          (github.event_name == 'workflow_dispatch' &&
          (github.event.inputs.service == 'glance' ||
            github.event.inputs.service == 'all'))
        run: >
          ansible-playbook -i inventorys
          --limit glance
          --skip-tags user,lxc_config.ssh,glance.setup
          container_configure.yml
      - name: Update Caddy vhosts
        if: |
          (steps.filter.outputs.caddy == 'true' && github.event_name != 'workflow_dispatch') ||
          (github.event_name == 'workflow_dispatch' &&
          (github.event.inputs.service == 'caddy' ||
            github.event.inputs.service == 'all'))
        run: >
          ansible-playbook -i inventorys
          --limit caddy
          --skip-tags user,lxc_config.ssh,caddy.setup,caddy.alloy
          container_configure.yml
      - name: Update ntfy users
        if: |
          (steps.filter.outputs.ntfy == 'true' && github.event_name != 'workflow_dispatch') ||
          (github.event_name == 'workflow_dispatch' &&
          (github.event.inputs.service == 'ntfy' ||
            github.event.inputs.service == 'all'))
        run: >
          ansible-playbook -i inventorys
          --limit ntfy
          --skip-tags user,lxc_config.ssh,ntfy.setup
          container_configure.yml
      - name: Create new container
        if: |
          (steps.filter.outputs.pve == 'true' && github.event_name != 'workflow_dispatch') ||
          (github.event_name == 'workflow_dispatch' &&
          (github.event.inputs.service == 'pve' ||
            github.event.inputs.service == 'all'))
        run: >
          ansible-playbook -i inventorys
          --skip-tags update_lxc
          container_create.yml
      - name: Send notification to Discord
        uses: https://github.com/sarisia/actions-status-discord@v1
        if: always()
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
          status: ${{ job.status }}
          title: "Auto Update"
          description: "Automatic HomeLab Updates"
          url: "https://git.berger-em.net/bergefe/HomeLab"
          username: Forgejo Actions
          
```

To run this pipeline I had to build my own docker container image. This image includes Ansible, NodeJS, 1Password-CLI and Mitogen. Here you can get the [Dockerfile](https://git.berger-em.net/bergefe/docker-images/src/branch/main/forgejo/ubuntu/24.04-ansible/Dockerfile) to create your own version.

## Future

I am still working on this topic and I try to add more features. The goal for this project is to be able to maintain and update my HomeLab with a single Ansible-Playbook, In the best case, most of the tasks will run on its own and just send me some notification when something went wrong.
